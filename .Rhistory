library(forecast)
dados = read.csv("dadostrabalho.csv",header=T, na.strings = ":",check.names = F)
setwd("C:/Users/Lenovo/Desktop/Universidade/3º ano/Séries Temporais")
dados = read.csv("dadostrabalho.csv",header=T, na.strings = ":",check.names = F)
#retirar colunas e linhas n necessarias
dados=dados[,-(3:5)]
dados=dados[,-(4:5)]
dados=dados[-(93:235),]
dados=dados[-(1:3),]
dados=dados[,-3]
#sÃ©rie temporal discreta
summary(dados[,2])
seriet = ts(dados[,2],start=c(2001,8),frequency=12)
seriet
plot(seriet,main="Volume afluente mensal na albufeira da Bemposta",ylab="volume afluente (dam3)")
#modelo proposto
auto.arima(seriet)
#serie com transformaÃ§Ã£o box cox
lambda = BoxCox.lambda(seriet,lower=-1,method = "loglik")
boxcox=BoxCox(seriet, lambda = lambda)
plot(boxcox)
plot(decompose(boxcox))
m0=auto.arima(boxcox)
summary(m0)
plot(forecast(m0))
shapiro.test(m0$residuals)
acf(m0$residuals)
pacf(m0$residuals)
#resumo dados
summary(dados)
#desvio padrao e variancia
sd(dados[,2])
var(dados[,2])
#histograma e boxplot
hist(dados[,2],main="Histograma volume afluente mensal na albufeira da Bemposta" ,xlab="volume (dam3)")
boxplot(dados[,2],main="Boxplot volume afluente mensal na albufeira da Bemposta" ,ylab="volume(dam3)")
boxplot(boxcox)
#decompose
plot(decompose(seriet))
plot(decompose(boxcox))
decompose(boxcox)
#FAC e FACP serie nao logaritmizada
acf(seriet,main="FAC",na.action = na.omit)
acf(seriet, plot=FALSE,na.action = na.omit)
pacf(seriet , main="FACP",na.action = na.omit)
pacf(seriet, plot=FALSE,na.action = na.omit)
#FAC e FACP serie logaritmizada
acf(boxcox,main="FAC",na.action = na.omit)
acf(boxcox, plot=FALSE,na.action = na.omit)
pacf(boxcox , main="FACP",na.action = na.omit)
pacf(boxcox, plot=FALSE,na.action = na.omit)
#d=?
auxiliar = arima(boxcox, order=c(0,0,0), seasonal=list(order=c(0,0,0), period=12))
plot(auxiliar$residuals, main="apos diferenciacao")
#s=?
periodogram=spectrum(boxcox, plot=F)
imax=which.max(periodogram$spec)
periodo=1/periodogram$freq[imax]
periodo
#D=?
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,0), period=12))
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,0), period=12))
#aic=-148.57 e coeficientes  significativos
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,1), period=12))
#aic=-150.42 e coeficientes significativos
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(0,0,1), period=12))
#aic=-149.73 e coeficientes significativos
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(2,0,1), period=12))
#aic=-147.84 e coeficientes significativos
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,2), period=12))
#aic= -148.73 e coeficientes significativos
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,3), period=12))
#escolhido:
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,1), period=12))
arima(boxcox, order=c(0,0,0), seasonal=list(order=c(1,0,1), period=12))
#aic=-150.42 e coeficientes significativos
arima(boxcox, order=c(1,0,0), seasonal=list(order=c(1,0,1), period=12))
#aic=-213.7 e coeficientes significativos
arima(boxcox, order=c(0,0,1), seasonal=list(order=c(1,0,1), period=12))
#aic=-200.45 e coeficientes n significativos
arima(boxcox, order=c(1,0,1), seasonal=list(order=c(1,0,1), period=12))
#aic=-214.77 e coeficientes n significativos
arima(boxcox, order=c(1,0,2), seasonal=list(order=c(1,0,1), period=12))
#aic=-212.83 e coeficientes significativos
arima(boxcox, order=c(2,0,2), seasonal=list(order=c(1,0,1), period=12))
#aic=-211.34 e coeficientes n significativos
arima(boxcox, order=c(2,0,3), seasonal=list(order=c(2,0,1), period=12))
#escolhido:
arima(boxcox, order=c(1,0,1), seasonal=list(order=c(1,0,1), period=12))
#concluindo escolhemos o modelo SARIMA(0,0,0)x(1,1,2)s=1
modelo=arima(boxcox, order=c(1,0,1), seasonal=list(order=c(1,0,1), period=12))
modelo$coef[1] + c(-1,1) * qnorm(0.975) * sqrt(modelo$var.coef[1,1])
modelo$coef[2] + c(-1,1) * qnorm(0.975) * sqrt(modelo$var.coef[2,2])
modelo$coef[3] + c(-1,1) * qnorm(0.975) * sqrt(modelo$var.coef[3,3])
modelo$coef[4] + c(-1,1) * qnorm(0.975) * sqrt(modelo$var.coef[4,4])
#variancia estimada dos erros
modelo$sigma2
modelo
resi=modelo$residuals
resi
layout(matrix(c(1,2,3,4),2,byrow=T))
plot(as.vector(resi), main="Representacao grafica dos residuos", ylab="")
#residuos sao homocedasticos (n dependem de t)
hist(resi, freq=F, main="Histograma dos residuos", xlab="residuos", ylab="frequencia relativa")
curve(dnorm(x, mean(resi), sd(resi)), add=T)
acf(resi, main="FAC dos resíduos", ylab="FAC")
pacf(resi, main="FACP dos resíduos", ylab="FACP")
#correlacao dos residuos
Box.test(resi,lag = 1)
#normalidade
shapiro.test(resi)
ks.test(resi, "pnorm", mean=mean(resi), sd=sd(resi))
#media = 0
t.test(resi, mu=0)
#observados vs estimados (boxcox)
est.dados = fitted.values(modelo)
res.dados = boxcox- est.dados
ts.plot(boxcox, main = "Dados Transformados com lambda=0.05")
lines(ts(est.dados, start=c(2001,8), frequency=12), col="red")
## observados vs estimados (original)
est = InvBoxCox(est.dados,lambda)
inver = round(est, digits = 0)
res =  seriet - est
ts.plot(seriet, main = "Dados originais")
lines(ts(inver, start=c(2001,8), frequency=12), col="red")
modelo1=arima(boxcox[1:65], order=c(1,0,1), seasonal=list(order=c(1,0,1), period=12))
previsao = predict(modelo1, n.ahead = 24)
inv_prev = InvBoxCox(previsao$pred,lambda)
inver_prev = round(inv_prev, digits = 0)
#intervalos, dados transformados
low = previsao$pred - 1.96*previsao$se
upper = previsao$pred + 1.96*previsao$se
#intervalos, dados originais
low2 = round(InvBoxCox(low,lambda), digits = 0)
upper2 = round(InvBoxCox(upper,lambda), digits = 0)
# grafico de previsao, estimados vs observados - dados transformados
ts.plot(boxcox, main = "Dados Transformados", xlim=c(2001.8,2009),ylim=c(5.4,6.1))
lines(ts(previsao$pred, start=c(2007,1), frequency=12), col="blue")
lines(ts(low, start=c(2007,1), deltat=1/12), lty=3, col="blue")
lines(ts(upper,start=c(2007,1), deltat=1/12), lty=3, col="blue")
est.dad = fitted.values(modelo1)
lines(ts(est.dad, start=c(2001,8), frequency=12), col="red")
# grafico de previsao, estimados vs observados - dados originais
ts.plot(seriet, main = "Dados originais", ylab="volume (dam3)", xlim=c(2001.8,2009),ylim=c(0,2750000))
lines(ts(inver_prev, start=c(2007,1), frequency=12), col="blue")
lines(ts(low2, start=c(2007,1), deltat=1/12), lty=3, col="blue")
lines(ts(upper2, start=c(2007,1), deltat=1/12), lty=3, col="blue")
est1 = InvBoxCox(est.dad,lambda)
lines(ts(est1, start=c(2001,8), frequency=12), col="red")
legend("topleft", legend = c("Série observada", "Estimativas", "Previsões", "Intervalos de previsao (95%)"), col = c("black", "red", "blue", "blue"), lty = c(1,1,1,2), bty="n")
#concluindo escolhemos o modelo SARIMA(0,0,0)x(1,1,2)s=1
modelo=arima(boxcox, order=c(1,0,1), seasonal=list(order=c(1,0,1), period=12))
arima(boxcox, order=c(1,0,1), seasonal=list(order=c(1,0,1), period=12))
#variancia estimada dos erros
modelo$sigma2
#variancia estimada dos erros
sqrt(modelo$sigma2 )
